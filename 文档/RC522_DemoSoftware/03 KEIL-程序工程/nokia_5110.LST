C51 COMPILER V9.00   NOKIA_5110                                                            03/19/2014 03:47:10 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE NOKIA_5110
OBJECT MODULE PLACED IN nokia_5110.OBJ
COMPILER INVOKED BY: F:\Program Files\KEIL4\C51\BIN\C51.EXE nokia_5110.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /********************************************************************
   2          * 程序名  ： Nokia_5110显示程序
   3          * 版本号  ： V1.0
   4          * 描述    :  51单片机Nokia_5110显示程序
   5                                   该试验使用的单片机型号是STC89C52(51)，晶振是11.0592Mhz。
   6                                   该程序工程是由Keil4创建，如在使用低版本时未能成功打开或
   7                                   正常编译，请使用Keil4。
   8          * 日期    ： 2013年9月26日
   9          * 创建    ： 群元科技
  10          * 网址    ： www.qunyuankeji.com
  11          * 联系方式： QQ: 2810867461
  12          * 版权所有 违者必究，如有需要请联系我们。
  13          ********************************************************************/
  14          #include "nokia_5110.h"//Nokia_5110函数文件
  15          #include "english_6x8_pixel.h"//英文字库
  16          #include "write_chinese_string_pixel.h"//中文字库
  17          
  18          /********************************************************************
  19          * 名称   : delay_1us_5110()
  20          * 功能   : 1us延时函数
  21          * 变量   : 无
  22          * 返回值 : 无
  23          ********************************************************************/
  24          void delay_1us_5110(void)               
  25          {
  26   1      
  27   1              unsigned int i;
  28   1      
  29   1              for(i=0;i<10;i++);
  30   1      
  31   1      }
  32          
  33          /********************************************************************
  34          * 名称   : delay_1ms_5110()
  35          * 功能   : 1ms延时函数
  36          * 变量   : 无
  37          * 返回值 : 无
  38          ********************************************************************/
  39          void delay_1ms_5110(void)          
  40          {
  41   1      
  42   1              unsigned int i;
  43   1      
  44   1              for (i=0;i<114;i++);
  45   1      
  46   1      }
  47          
  48          /********************************************************************
  49          * 名称   : delay_nms_5110()
  50          * 功能   : N ms延时函数
  51          * 变量   : n--毫秒数
  52          * 返回值 : 无
  53          ********************************************************************/  
  54          void delay_nms_5110(unsigned int n) 
  55          {
C51 COMPILER V9.00   NOKIA_5110                                                            03/19/2014 03:47:10 PAGE 2   

  56   1      
  57   1              unsigned int i=0;
  58   1      
  59   1              for (i=0;i<n;i++)
  60   1                      delay_1ms_5110();
  61   1      }
  62          
  63          /********************************************************************
  64          * 名称   : LCD_init()
  65          * 功能   : Nokia_5110初始化
  66          * 变量   : 无
  67          * 返回值 : 无
  68          ********************************************************************/ 
  69          void LCD_init(void)
  70          {
  71   1              
  72   1              LCD_RST= 0;// 产生一个让LCD复位的低电平脉冲
  73   1              delay_1us_5110();
  74   1              LCD_RST= 1;
  75   1              LCD_CE= 0;// 关闭LCD
  76   1              delay_1us_5110();
  77   1              LCD_CE= 1; // 使能LCD
  78   1              delay_1us_5110();
  79   1              
  80   1              LCD_write_byte(0x21, 0);        // 使用扩展命令设置LCD模式
  81   1              LCD_write_byte(0xc8, 0);        // 设置偏置电压
  82   1              LCD_write_byte(0x06, 0);        // 温度校正
  83   1              LCD_write_byte(0x13, 0);        // 1:48
  84   1              LCD_write_byte(0x20, 0);        // 使用基本命令
  85   1              LCD_clear();            // 清屏
  86   1              LCD_write_byte(0x0c, 0);        // 设定显示模式，正常显示
  87   1              
  88   1              LCD_CE= 0;  // 关闭LCD
  89   1      
  90   1      }
  91          
  92          /********************************************************************
  93          * 名称   : LCD_clear()
  94          * 功能   : Nokia_5110清屏函数
  95          * 变量   : 无
  96          * 返回值 : 无
  97          ********************************************************************/ 
  98          void LCD_clear(void)
  99          {
 100   1      
 101   1              unsigned int i;
 102   1      
 103   1              LCD_write_byte(0x0c, 0);                        
 104   1              LCD_write_byte(0x80, 0);                        
 105   1              for (i=0; i<504; i++)
 106   1                      LCD_write_byte(0, 1);
 107   1                                      
 108   1      }
 109          
 110          /********************************************************************
 111          * 名称   : LCD_set_XY()
 112          * 功能   : 设置LCD坐标函数
 113          * 变量   : X--0-83，Y--0-5
 114          * 返回值 : 无
 115          ********************************************************************/ 
 116          void LCD_set_XY(unsigned char X, unsigned char Y)
 117          {
C51 COMPILER V9.00   NOKIA_5110                                                            03/19/2014 03:47:10 PAGE 3   

 118   1              LCD_write_byte(0x40 | Y, 0);            // column
 119   1              LCD_write_byte(0x80 | X, 0);      // row
 120   1      }
 121          
 122          /********************************************************************
 123          * 名称   : LCD_write_char()
 124          * 功能   : 显示英文字符
 125          * 变量   : C--显示的字符
 126          * 返回值 : 无
 127          ********************************************************************/ 
 128          void LCD_write_char(unsigned char c)
 129          {
 130   1      
 131   1              unsigned char line;
 132   1              
 133   1              c -= 32;
 134   1              for (line=0; line<6; line++)
 135   1                      LCD_write_byte(font6x8[c][line], 1);
 136   1      
 137   1      }
 138          /********************************************************************
 139          * 名称   : LCD_write_english_string()
 140          * 功能   : 英文字符串显示函数
 141          * 变量   : *s -- 英文字符串指针
 142                             X,Y-- 显示字符串的位置,x 0-83 ,y 0-5
 143          * 返回值 : 无
 144          ********************************************************************/ 
 145          void LCD_write_english_string(unsigned char X,unsigned char Y,char *s)
 146          {
 147   1      
 148   1              LCD_set_XY(X,Y);
 149   1              while (*s) 
 150   1              {
 151   2                      LCD_write_char(*s);
 152   2                      s++;
 153   2              }
 154   1      
 155   1      }  
 156          /********************************************************************
 157          * 名称   : LCD_write_byte()
 158          * 功能   : 使用SPI接口写数据到LCD
 159          * 变量   : data -- 写入的数据
 160                             command-- 写数据/命令选择
 161          * 返回值 : 无
 162          ********************************************************************/ 
 163          void LCD_write_byte(unsigned char dat, unsigned char command)
 164          {
 165   1      
 166   1              unsigned char i;
 167   1      
 168   1              LCD_CE= 0;
 169   1              
 170   1              if (!command)
 171   1                      LCD_DC= 0;
 172   1              if (command)
 173   1                      LCD_DC= 1;
 174   1      
 175   1              for(i=0;i<8;i++)
 176   1              {
 177   2                      if(dat&0x80)
 178   2                        LCD_DIN= 1;
 179   2                      if(!(dat&0x80))
C51 COMPILER V9.00   NOKIA_5110                                                            03/19/2014 03:47:10 PAGE 4   

 180   2                        LCD_DIN= 0;
 181   2      
 182   2                      LCD_SCLK= 0;
 183   2                      dat = dat << 1;
 184   2                      LCD_SCLK= 1;
 185   2              }
 186   1      
 187   1              LCD_CE= 1;  // 关闭LCD
 188   1      }
 189          
 190          /********************************************************************
 191          * 名称   : LCD_write_chinese_string()
 192          * 功能   : 在LCD上显示汉字
 193          * 变量   ：X、Y   --显示汉字的起始X、Y坐标；
 194                     ch_with--汉字点阵的宽度
 195                     num    --显示汉字的个数；  
 196                     line   --汉字点阵数组中的起始行数
 197                     row    --汉字显示的行间距
 198          * 返回值 : 无
 199          ********************************************************************/                       
 200          void LCD_write_chinese_string(unsigned char X, unsigned char Y, 
 201                             unsigned char ch_with,unsigned char num,
 202                             unsigned char line,unsigned char row)
 203          {
 204   1      
 205   1              unsigned char i,n;
 206   1              
 207   1              LCD_set_XY(X,Y);//设置初始位置
 208   1              
 209   1              for (i=0;i<num;)
 210   1              {
 211   2                      for (n=0; n<ch_with*2; n++) //写一个汉字
 212   2                      { 
 213   3                              if (n==ch_with)//写汉字的下半部分
 214   3                              {
 215   4                                      if (i==0) 
 216   4                                              LCD_set_XY(X,Y+1);
 217   4                                      else
 218   4                                              LCD_set_XY((X+(ch_with+row)*i),Y+1);
 219   4                              }
 220   3                              LCD_write_byte(write_chinese[line+i][n],1);
 221   3                      }
 222   2                      i++;
 223   2                      LCD_set_XY((X+(ch_with+row)*i),Y);
 224   2              }
 225   1      }                                       
 226            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    459    ----
   CONSTANT SIZE    =   1080    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      16
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
