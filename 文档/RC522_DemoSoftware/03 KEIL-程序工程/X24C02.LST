C51 COMPILER V9.00   X24C02                                                                06/08/2014 20:31:50 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE X24C02
OBJECT MODULE PLACED IN X24C02.OBJ
COMPILER INVOKED BY: E:\Program Files\KEIL\C51\BIN\C51.EXE X24C02.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include"X24C02.h"
   2          /********************************************************************
   3          * 名称 : delay1()
   4          * 功能 : 短暂延时
   5          * 输入 : x
   6          * 输出 : 无
   7          ***********************************************************************/
   8          void x24c02_delay1(unsigned char x)
   9          {  
  10   1              unsigned int i;
  11   1              for(i=0; i<x; i++);
  12   1      }
  13          
  14          /********************************************************************
  15          * 名称 : flash()
  16          * 功能 : 延时,时间为2个NOP，大概为2US
  17          * 输入 : 无
  18          * 输出 : 无
  19          ***********************************************************************/
  20          void x24c02_flash(void) 
  21          {
  22   1              _nop_();
  23   1              _nop_();
  24   1      }
  25          
  26          /********************************************************************
  27          * 名称 : x24c02_init()
  28          * 功能 : 24c02初始化子程序
  29          * 输入 : 无
  30          * 输出 : 无
  31          ***********************************************************************/
  32          void x24c02_init(void) 
  33          {
  34   1              x24c02_scl = 1;
  35   1              x24c02_flash();
  36   1              x24c02_sda = 1;
  37   1              x24c02_flash();
  38   1      }
  39          
  40          /********************************************************************
  41          * 名称 : start(void)
  42          * 功能 : 启动I2C总线
  43          * 输入 : 无
  44          * 输出 : 无
  45          ***********************************************************************/
  46          void x24c02_start(void)
  47          {
  48   1              x24c02_sda = 1;
  49   1              x24c02_flash(); 
  50   1              x24c02_scl = 1; 
  51   1              x24c02_flash(); 
  52   1              x24c02_sda = 0; 
  53   1              x24c02_flash(); 
  54   1              x24c02_scl = 0; 
  55   1              x24c02_flash();
C51 COMPILER V9.00   X24C02                                                                06/08/2014 20:31:50 PAGE 2   

  56   1      }
  57          
  58          /********************************************************************
  59          * 名称 : stop()
  60          * 功能 : 停止I2C总线
  61          * 输入 : 无
  62          * 输出 : 无
  63          ***********************************************************************/
  64          void x24c02_stop() 
  65          {
  66   1              x24c02_sda = 0; 
  67   1              x24c02_flash();
  68   1              x24c02_scl = 1;
  69   1              x24c02_flash();
  70   1              x24c02_sda = 1;
  71   1              x24c02_flash();
  72   1      }
  73          
  74          /********************************************************************
  75          * 名称 : writex()
  76          * 功能 : 写一个字节
  77          * 输入 : j（需要写入的值）
  78          * 输出 : 无
  79          ***********************************************************************/
  80          void x24c02_writex(unsigned char j)
  81          {  
  82   1              unsigned char i,temp;
  83   1              temp = j;
  84   1              for(i=0; i<8; i++)
  85   1              {
  86   2                      temp = temp << 1; 
  87   2                      x24c02_scl = 0; 
  88   2                      x24c02_flash(); 
  89   2                      x24c02_sda = CY; 
  90   2                      x24c02_flash();
  91   2                      x24c02_scl = 1; 
  92   2                      x24c02_flash();
  93   2              }
  94   1              x24c02_scl = 0;
  95   1              x24c02_flash(); 
  96   1              x24c02_sda = 1;
  97   1              x24c02_flash();
  98   1      }
  99          
 100          /********************************************************************
 101          * 名称 : readx()
 102          * 功能 : 读一个字节
 103          * 输入 : 无
 104          * 输出 : 读出的值
 105          ***********************************************************************/
 106          unsigned char x24c02_readx(void)
 107          {
 108   1              unsigned char i, j, k = 0;
 109   1              x24c02_scl = 0;
 110   1              x24c02_flash();
 111   1              x24c02_sda = 1;
 112   1              for(i=0; i<8; i++)
 113   1              {  
 114   2                      x24c02_flash();
 115   2                      x24c02_scl = 1;
 116   2                      x24c02_flash();
 117   2                      if(x24c02_sda == 1)
C51 COMPILER V9.00   X24C02                                                                06/08/2014 20:31:50 PAGE 3   

 118   2                      {
 119   3                              j = 1;
 120   3                      }
 121   2                      else j = 0;
 122   2                      k = (k << 1) | j; 
 123   2                      x24c02_scl = 0;
 124   2              }
 125   1              x24c02_flash(); 
 126   1              return(k);
 127   1      }
 128          
 129          /********************************************************************
 130          * 名称 : clock()
 131          * 功能 : I2C总线时钟
 132          * 输入 : 无
 133          * 输出 : 无
 134          ***********************************************************************/
 135          void x24c02_clock(void)
 136          {
 137   1              unsigned char i = 0;
 138   1              x24c02_scl = 1;
 139   1              x24c02_flash();
 140   1              while((x24c02_sda == 1) && (i < 255)) 
 141   1              {
 142   2                      i++;
 143   2              }
 144   1              x24c02_scl = 0;
 145   1              x24c02_flash();
 146   1      }
 147          
 148          /********************************************************************
 149          * 名称 : x24c02_read()
 150          * 功能 : 从24c02中读出值
 151          * 输入 : address(要在这个地址读取值）
 152          * 输出 : 从24c02中读出的值
 153          ***********************************************************************/
 154          unsigned char x24c02_read(unsigned char address)
 155          {
 156   1              unsigned char i;
 157   1              x24c02_start();
 158   1              x24c02_writex(0xa0);
 159   1              x24c02_clock();
 160   1              x24c02_writex(address);
 161   1              x24c02_clock();
 162   1              x24c02_start();
 163   1              x24c02_writex(0xa1);
 164   1              x24c02_clock();
 165   1              i = x24c02_readx();
 166   1              x24c02_stop();
 167   1              x24c02_delay1(10);
 168   1              return(i);
 169   1      }
 170          
 171          /********************************************************************
 172          * 名称 : x24c02_write()
 173          * 功能 : 想24c02中写入数据
 174          * 输入 : address(地址） ， info（值）
 175          * 输出 : 无
 176          ***********************************************************************/
 177          void x24c02_write(unsigned char address, unsigned char info)
 178          {
 179   1              EA = 0;
C51 COMPILER V9.00   X24C02                                                                06/08/2014 20:31:50 PAGE 4   

 180   1              x24c02_start();
 181   1              x24c02_writex(0xa0);
 182   1              x24c02_clock();
 183   1              x24c02_writex(address);
 184   1              x24c02_clock();
 185   1              x24c02_writex(info);
 186   1              x24c02_clock();
 187   1              x24c02_stop();
 188   1              EA = 1;
 189   1              x24c02_delay1(50);
 190   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    235    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
